# 使用实时语音转写<a name="sis_05_0046"></a>

## 前提条件<a name="section3443190201812"></a>

-   确保已按照[配置Java环境](配置Java环境.md)配置完毕。
-   确保已存在待识别的音频文件。如果需要请在下载的SDK压缩包中获取示例音频。

## 初始化Client<a name="section52701821173516"></a>

初始化RasrClient，其参数包括UserInfo、RasrListener、SisConfig。

RasrListener需要用户自定义实现监听逻辑，UserInfo和SisConfig 详见[表 UserInfo数据结构](#table2044651713012)、[表 SisConfig数据结构](#table1472511119912)。

**表 1**  UserInfo数据结构

<a name="table2044651713012"></a>
<table><thead align="left"><tr id="row184472171906"><th class="cellrowborder" valign="top" width="14.82%" id="mcps1.2.5.1.1"><p id="p157537619610"><a name="p157537619610"></a><a name="p157537619610"></a>参数名称</p>
</th>
<th class="cellrowborder" valign="top" width="14.21%" id="mcps1.2.5.1.2"><p id="p6753969615"><a name="p6753969615"></a><a name="p6753969615"></a>是否必选</p>
</th>
<th class="cellrowborder" valign="top" width="14.729999999999999%" id="mcps1.2.5.1.3"><p id="p71061015172018"><a name="p71061015172018"></a><a name="p71061015172018"></a>参数类型</p>
</th>
<th class="cellrowborder" valign="top" width="56.24%" id="mcps1.2.5.1.4"><p id="p117531161263"><a name="p117531161263"></a><a name="p117531161263"></a>描述</p>
</th>
</tr>
</thead>
<tbody><tr id="row7447917707"><td class="cellrowborder" valign="top" width="14.82%" headers="mcps1.2.5.1.1 "><p id="p192554136319"><a name="p192554136319"></a><a name="p192554136319"></a>userName</p>
</td>
<td class="cellrowborder" valign="top" width="14.21%" headers="mcps1.2.5.1.2 "><p id="p12448151711012"><a name="p12448151711012"></a><a name="p12448151711012"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="14.729999999999999%" headers="mcps1.2.5.1.3 "><p id="p3448317704"><a name="p3448317704"></a><a name="p3448317704"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="56.24%" headers="mcps1.2.5.1.4 "><p id="p112551313139"><a name="p112551313139"></a><a name="p112551313139"></a>用户名。</p>
</td>
</tr>
<tr id="row144818171507"><td class="cellrowborder" valign="top" width="14.82%" headers="mcps1.2.5.1.1 "><p id="p192551413836"><a name="p192551413836"></a><a name="p192551413836"></a>password</p>
</td>
<td class="cellrowborder" valign="top" width="14.21%" headers="mcps1.2.5.1.2 "><p id="p164481817302"><a name="p164481817302"></a><a name="p164481817302"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="14.729999999999999%" headers="mcps1.2.5.1.3 "><p id="p2448111719016"><a name="p2448111719016"></a><a name="p2448111719016"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="56.24%" headers="mcps1.2.5.1.4 "><p id="p152555131630"><a name="p152555131630"></a><a name="p152555131630"></a>密码。</p>
</td>
</tr>
<tr id="row4448417305"><td class="cellrowborder" valign="top" width="14.82%" headers="mcps1.2.5.1.1 "><p id="p1925521315316"><a name="p1925521315316"></a><a name="p1925521315316"></a>domainNmae</p>
</td>
<td class="cellrowborder" valign="top" width="14.21%" headers="mcps1.2.5.1.2 "><p id="p84493171605"><a name="p84493171605"></a><a name="p84493171605"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="14.729999999999999%" headers="mcps1.2.5.1.3 "><p id="p1544961713018"><a name="p1544961713018"></a><a name="p1544961713018"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="56.24%" headers="mcps1.2.5.1.4 "><p id="p825510131635"><a name="p825510131635"></a><a name="p825510131635"></a>账户名，一般等同用户名。</p>
</td>
</tr>
<tr id="row18449161717011"><td class="cellrowborder" valign="top" width="14.82%" headers="mcps1.2.5.1.1 "><p id="p725510136314"><a name="p725510136314"></a><a name="p725510136314"></a>region</p>
</td>
<td class="cellrowborder" valign="top" width="14.21%" headers="mcps1.2.5.1.2 "><p id="p444991715012"><a name="p444991715012"></a><a name="p444991715012"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="14.729999999999999%" headers="mcps1.2.5.1.3 "><p id="p6449151710020"><a name="p6449151710020"></a><a name="p6449151710020"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="56.24%" headers="mcps1.2.5.1.4 "><p id="p148991840119"><a name="p148991840119"></a><a name="p148991840119"></a>区域，如cn-north-4, 参考<a href="https://support.huaweicloud.com/api-sis/sis_03_0004.html" target="_blank" rel="noopener noreferrer">终端节点</a>。</p>
</td>
</tr>
<tr id="row184491174011"><td class="cellrowborder" valign="top" width="14.82%" headers="mcps1.2.5.1.1 "><p id="p112566131134"><a name="p112566131134"></a><a name="p112566131134"></a>projectId</p>
</td>
<td class="cellrowborder" valign="top" width="14.21%" headers="mcps1.2.5.1.2 "><p id="p44503171300"><a name="p44503171300"></a><a name="p44503171300"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="14.729999999999999%" headers="mcps1.2.5.1.3 "><p id="p045010171901"><a name="p045010171901"></a><a name="p045010171901"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="56.24%" headers="mcps1.2.5.1.4 "><p id="p6644194817249"><a name="p6644194817249"></a><a name="p6644194817249"></a>项目ID，同region一一对应，参考<a href="https://support.huaweicloud.com/api-sis/sis_03_0008.html" target="_blank" rel="noopener noreferrer">获取项目ID</a>。</p>
</td>
</tr>
<tr id="row1963318255017"><td class="cellrowborder" valign="top" width="14.82%" headers="mcps1.2.5.1.1 "><p id="p12256171315310"><a name="p12256171315310"></a><a name="p12256171315310"></a>serviceEndpoint</p>
</td>
<td class="cellrowborder" valign="top" width="14.21%" headers="mcps1.2.5.1.2 "><p id="p106342251707"><a name="p106342251707"></a><a name="p106342251707"></a>否</p>
</td>
<td class="cellrowborder" valign="top" width="14.729999999999999%" headers="mcps1.2.5.1.3 "><p id="p763472517013"><a name="p763472517013"></a><a name="p763472517013"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="56.24%" headers="mcps1.2.5.1.4 "><p id="p132566131733"><a name="p132566131733"></a><a name="p132566131733"></a>一般使用默认即可。</p>
</td>
</tr>
<tr id="row202256311607"><td class="cellrowborder" valign="top" width="14.82%" headers="mcps1.2.5.1.1 "><p id="p1525612138315"><a name="p1525612138315"></a><a name="p1525612138315"></a>tokenEndpoint</p>
</td>
<td class="cellrowborder" valign="top" width="14.21%" headers="mcps1.2.5.1.2 "><p id="p0225143120011"><a name="p0225143120011"></a><a name="p0225143120011"></a>否</p>
</td>
<td class="cellrowborder" valign="top" width="14.729999999999999%" headers="mcps1.2.5.1.3 "><p id="p1922518315014"><a name="p1922518315014"></a><a name="p1922518315014"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="56.24%" headers="mcps1.2.5.1.4 "><p id="p1525618131732"><a name="p1525618131732"></a><a name="p1525618131732"></a>一般使用默认即可。</p>
</td>
</tr>
</tbody>
</table>

**表 2**  SisConfig数据结构

<a name="table1472511119912"></a>
<table><thead align="left"><tr id="row28221511196"><th class="cellrowborder" valign="top" width="13.950000000000001%" id="mcps1.2.5.1.1"><p id="p7822611594"><a name="p7822611594"></a><a name="p7822611594"></a>参数名称</p>
</th>
<th class="cellrowborder" valign="top" width="10.16%" id="mcps1.2.5.1.2"><p id="p782213111916"><a name="p782213111916"></a><a name="p782213111916"></a>是否必选</p>
</th>
<th class="cellrowborder" valign="top" width="12.9%" id="mcps1.2.5.1.3"><p id="p1283016116306"><a name="p1283016116306"></a><a name="p1283016116306"></a>参数类型</p>
</th>
<th class="cellrowborder" valign="top" width="62.99%" id="mcps1.2.5.1.4"><p id="p188221711898"><a name="p188221711898"></a><a name="p188221711898"></a>描述</p>
</th>
</tr>
</thead>
<tbody><tr id="row158228111899"><td class="cellrowborder" valign="top" width="13.950000000000001%" headers="mcps1.2.5.1.1 "><p id="p1082211111395"><a name="p1082211111395"></a><a name="p1082211111395"></a>socketTimeout</p>
</td>
<td class="cellrowborder" valign="top" width="10.16%" headers="mcps1.2.5.1.2 "><p id="p1482210111595"><a name="p1482210111595"></a><a name="p1482210111595"></a>否</p>
</td>
<td class="cellrowborder" valign="top" width="12.9%" headers="mcps1.2.5.1.3 "><p id="p183181113308"><a name="p183181113308"></a><a name="p183181113308"></a>Integer</p>
</td>
<td class="cellrowborder" valign="top" width="62.99%" headers="mcps1.2.5.1.4 "><p id="p1182217115915"><a name="p1182217115915"></a><a name="p1182217115915"></a>Socket超时，默认5000，单位ms。</p>
</td>
</tr>
<tr id="row11822151111916"><td class="cellrowborder" valign="top" width="13.950000000000001%" headers="mcps1.2.5.1.1 "><p id="p88224114915"><a name="p88224114915"></a><a name="p88224114915"></a>connectionTimeout</p>
</td>
<td class="cellrowborder" valign="top" width="10.16%" headers="mcps1.2.5.1.2 "><p id="p138226111794"><a name="p138226111794"></a><a name="p138226111794"></a>否</p>
</td>
<td class="cellrowborder" valign="top" width="12.9%" headers="mcps1.2.5.1.3 "><p id="p6831141123015"><a name="p6831141123015"></a><a name="p6831141123015"></a>Integer</p>
</td>
<td class="cellrowborder" valign="top" width="62.99%" headers="mcps1.2.5.1.4 "><p id="p1882212111895"><a name="p1882212111895"></a><a name="p1882212111895"></a>连接超时，默认5000，单位ms。</p>
</td>
</tr>
<tr id="row10822511395"><td class="cellrowborder" valign="top" width="13.950000000000001%" headers="mcps1.2.5.1.1 "><p id="p48222011195"><a name="p48222011195"></a><a name="p48222011195"></a>requestTimeout</p>
</td>
<td class="cellrowborder" valign="top" width="10.16%" headers="mcps1.2.5.1.2 "><p id="p16822121118911"><a name="p16822121118911"></a><a name="p16822121118911"></a>否</p>
</td>
<td class="cellrowborder" valign="top" width="12.9%" headers="mcps1.2.5.1.3 "><p id="p98312011173013"><a name="p98312011173013"></a><a name="p98312011173013"></a>Integer</p>
</td>
<td class="cellrowborder" valign="top" width="62.99%" headers="mcps1.2.5.1.4 "><p id="p1882281115916"><a name="p1882281115916"></a><a name="p1882281115916"></a>请求超时，默认1000，单位ms。</p>
</td>
</tr>
</tbody>
</table>

## 请求参数<a name="section16821438355"></a>

请求类为RasrRequest，详见[表 RasrRequest数据结构](#table89615681013)。

**表 3**  RasrRequest数据结构

<a name="table89615681013"></a>
<table><thead align="left"><tr id="row17977651017"><th class="cellrowborder" valign="top" width="14.82%" id="mcps1.2.5.1.1"><p id="p10138111181020"><a name="p10138111181020"></a><a name="p10138111181020"></a>参数名称</p>
</th>
<th class="cellrowborder" valign="top" width="9.76%" id="mcps1.2.5.1.2"><p id="p4138311181014"><a name="p4138311181014"></a><a name="p4138311181014"></a>是否必选</p>
</th>
<th class="cellrowborder" valign="top" width="12.29%" id="mcps1.2.5.1.3"><p id="p113881131012"><a name="p113881131012"></a><a name="p113881131012"></a>参数类型</p>
</th>
<th class="cellrowborder" valign="top" width="63.129999999999995%" id="mcps1.2.5.1.4"><p id="p191381211171014"><a name="p191381211171014"></a><a name="p191381211171014"></a>描述</p>
</th>
</tr>
</thead>
<tbody><tr id="row19972681020"><td class="cellrowborder" valign="top" width="14.82%" headers="mcps1.2.5.1.1 "><p id="p9273360259"><a name="p9273360259"></a><a name="p9273360259"></a>audioFormat</p>
</td>
<td class="cellrowborder" valign="top" width="9.76%" headers="mcps1.2.5.1.2 "><p id="p397106161019"><a name="p397106161019"></a><a name="p397106161019"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="12.29%" headers="mcps1.2.5.1.3 "><p id="p129811612104"><a name="p129811612104"></a><a name="p129811612104"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="63.129999999999995%" headers="mcps1.2.5.1.4 "><p id="p76172993511"><a name="p76172993511"></a><a name="p76172993511"></a>音频格式，支持pcm，alaw，ulaw等，如pcm8k16bit，参见《API参考》中<a href="https://support.huaweicloud.com/api-sis/sis_03_0030.html" target="_blank" rel="noopener noreferrer">开始识别</a>章节。</p>
</td>
</tr>
<tr id="row6981063105"><td class="cellrowborder" valign="top" width="14.82%" headers="mcps1.2.5.1.1 "><p id="p1597821114351"><a name="p1597821114351"></a><a name="p1597821114351"></a>property</p>
</td>
<td class="cellrowborder" valign="top" width="9.76%" headers="mcps1.2.5.1.2 "><p id="p5729163011115"><a name="p5729163011115"></a><a name="p5729163011115"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="12.29%" headers="mcps1.2.5.1.3 "><p id="p8983612108"><a name="p8983612108"></a><a name="p8983612108"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="63.129999999999995%" headers="mcps1.2.5.1.4 "><p id="p29781311193515"><a name="p29781311193515"></a><a name="p29781311193515"></a>属性字符串，language_sampleRate_domain， 如chinese_8k_common，参见《API参考》中<a href="https://support.huaweicloud.com/api-sis/sis_03_0030.html" target="_blank" rel="noopener noreferrer">开始识别</a>章节。</p>
</td>
</tr>
<tr id="row12986661013"><td class="cellrowborder" valign="top" width="14.82%" headers="mcps1.2.5.1.1 "><p id="p67201334112615"><a name="p67201334112615"></a><a name="p67201334112615"></a>punc</p>
</td>
<td class="cellrowborder" valign="top" width="9.76%" headers="mcps1.2.5.1.2 "><p id="p14682123391117"><a name="p14682123391117"></a><a name="p14682123391117"></a>否</p>
</td>
<td class="cellrowborder" valign="top" width="12.29%" headers="mcps1.2.5.1.3 "><p id="p1372043422610"><a name="p1372043422610"></a><a name="p1372043422610"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="63.129999999999995%" headers="mcps1.2.5.1.4 "><p id="p5720193412613"><a name="p5720193412613"></a><a name="p5720193412613"></a>是否添加标点，yes 或 no，默认no。</p>
</td>
</tr>
<tr id="row9982614105"><td class="cellrowborder" valign="top" width="14.82%" headers="mcps1.2.5.1.1 "><p id="p5720134152612"><a name="p5720134152612"></a><a name="p5720134152612"></a>vadHead</p>
</td>
<td class="cellrowborder" valign="top" width="9.76%" headers="mcps1.2.5.1.2 "><p id="p0142123931114"><a name="p0142123931114"></a><a name="p0142123931114"></a>否</p>
</td>
<td class="cellrowborder" valign="top" width="12.29%" headers="mcps1.2.5.1.3 "><p id="p11720173422614"><a name="p11720173422614"></a><a name="p11720173422614"></a>Integer</p>
</td>
<td class="cellrowborder" valign="top" width="63.129999999999995%" headers="mcps1.2.5.1.4 "><p id="p14167132212382"><a name="p14167132212382"></a><a name="p14167132212382"></a>头部最大静音时间，[0, 60000]，默认10000ms。</p>
</td>
</tr>
<tr id="row17988614102"><td class="cellrowborder" valign="top" width="14.82%" headers="mcps1.2.5.1.1 "><p id="p5840175211381"><a name="p5840175211381"></a><a name="p5840175211381"></a>vadTail</p>
</td>
<td class="cellrowborder" valign="top" width="9.76%" headers="mcps1.2.5.1.2 "><p id="p108451139181116"><a name="p108451139181116"></a><a name="p108451139181116"></a>否</p>
</td>
<td class="cellrowborder" valign="top" width="12.29%" headers="mcps1.2.5.1.3 "><p id="p15720103413267"><a name="p15720103413267"></a><a name="p15720103413267"></a>Integer</p>
</td>
<td class="cellrowborder" valign="top" width="63.129999999999995%" headers="mcps1.2.5.1.4 "><p id="p9610191117391"><a name="p9610191117391"></a><a name="p9610191117391"></a>尾部最大静音时间，[0, 3000]，默认500ms。</p>
</td>
</tr>
<tr id="row16981761104"><td class="cellrowborder" valign="top" width="14.82%" headers="mcps1.2.5.1.1 "><p id="p27219345269"><a name="p27219345269"></a><a name="p27219345269"></a>maxSeconds</p>
</td>
<td class="cellrowborder" valign="top" width="9.76%" headers="mcps1.2.5.1.2 "><p id="p1357864015117"><a name="p1357864015117"></a><a name="p1357864015117"></a>否</p>
</td>
<td class="cellrowborder" valign="top" width="12.29%" headers="mcps1.2.5.1.3 "><p id="p16721103432615"><a name="p16721103432615"></a><a name="p16721103432615"></a>Integer</p>
</td>
<td class="cellrowborder" valign="top" width="63.129999999999995%" headers="mcps1.2.5.1.4 "><p id="p189071652203919"><a name="p189071652203919"></a><a name="p189071652203919"></a>音频最长持续时间， [0, 60]，默认30s。</p>
</td>
</tr>
<tr id="row19986619104"><td class="cellrowborder" valign="top" width="14.82%" headers="mcps1.2.5.1.1 "><p id="p16497121824012"><a name="p16497121824012"></a><a name="p16497121824012"></a>intermediateResult</p>
</td>
<td class="cellrowborder" valign="top" width="9.76%" headers="mcps1.2.5.1.2 "><p id="p3155041101112"><a name="p3155041101112"></a><a name="p3155041101112"></a>否</p>
</td>
<td class="cellrowborder" valign="top" width="12.29%" headers="mcps1.2.5.1.3 "><p id="p198431027194010"><a name="p198431027194010"></a><a name="p198431027194010"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="63.129999999999995%" headers="mcps1.2.5.1.4 "><p id="p14333313402"><a name="p14333313402"></a><a name="p14333313402"></a>是否显示中间结果，yes 或 no，默认no。</p>
</td>
</tr>
<tr id="row149122114146"><td class="cellrowborder" valign="top" width="14.82%" headers="mcps1.2.5.1.1 "><p id="p99132119142"><a name="p99132119142"></a><a name="p99132119142"></a>vocabularyId</p>
</td>
<td class="cellrowborder" valign="top" width="9.76%" headers="mcps1.2.5.1.2 "><p id="p129134121415"><a name="p129134121415"></a><a name="p129134121415"></a>否</p>
</td>
<td class="cellrowborder" valign="top" width="12.29%" headers="mcps1.2.5.1.3 "><p id="p14913215140"><a name="p14913215140"></a><a name="p14913215140"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="63.129999999999995%" headers="mcps1.2.5.1.4 "><p id="p189131116147"><a name="p189131116147"></a><a name="p189131116147"></a>热词表id，若没有则不填。</p>
</td>
</tr>
</tbody>
</table>

## 响应参数<a name="section973485583515"></a>

状态响应类为StateResponse，详见[表 StateResponse数据结构](#table332964451616)。

结果响应类为RasrResponse，详见[表 RasrResponse数据结构](#table41351312170)。

**表 4**  StateResponse数据结构

<a name="table332964451616"></a>
<table><thead align="left"><tr id="row18330144418168"><th class="cellrowborder" valign="top" width="15.17%" id="mcps1.2.5.1.1"><p id="p12321991193"><a name="p12321991193"></a><a name="p12321991193"></a>参数名称</p>
</th>
<th class="cellrowborder" valign="top" width="9.5%" id="mcps1.2.5.1.2"><p id="p732110971911"><a name="p732110971911"></a><a name="p732110971911"></a>是否必选</p>
</th>
<th class="cellrowborder" valign="top" width="12.55%" id="mcps1.2.5.1.3"><p id="p632114961914"><a name="p632114961914"></a><a name="p632114961914"></a>参数类型</p>
</th>
<th class="cellrowborder" valign="top" width="62.78%" id="mcps1.2.5.1.4"><p id="p123212919199"><a name="p123212919199"></a><a name="p123212919199"></a>描述</p>
</th>
</tr>
</thead>
<tbody><tr id="row15330184412167"><td class="cellrowborder" valign="top" width="15.17%" headers="mcps1.2.5.1.1 "><p id="p5330344181612"><a name="p5330344181612"></a><a name="p5330344181612"></a>state</p>
</td>
<td class="cellrowborder" valign="top" width="9.5%" headers="mcps1.2.5.1.2 "><p id="p3330344131610"><a name="p3330344131610"></a><a name="p3330344131610"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="12.55%" headers="mcps1.2.5.1.3 "><p id="p1330144171613"><a name="p1330144171613"></a><a name="p1330144171613"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="62.78%" headers="mcps1.2.5.1.4 "><p id="p19330944171610"><a name="p19330944171610"></a><a name="p19330944171610"></a>识别状态，包括start、end、fail。</p>
</td>
</tr>
<tr id="row153305449168"><td class="cellrowborder" valign="top" width="15.17%" headers="mcps1.2.5.1.1 "><p id="p15724494235"><a name="p15724494235"></a><a name="p15724494235"></a>traceId</p>
</td>
<td class="cellrowborder" valign="top" width="9.5%" headers="mcps1.2.5.1.2 "><p id="p17330134414168"><a name="p17330134414168"></a><a name="p17330134414168"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="12.55%" headers="mcps1.2.5.1.3 "><p id="p13330204421611"><a name="p13330204421611"></a><a name="p13330204421611"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="62.78%" headers="mcps1.2.5.1.4 "><p id="p163301644161617"><a name="p163301644161617"></a><a name="p163301644161617"></a>用于日志问题追溯。</p>
</td>
</tr>
<tr id="row433024413166"><td class="cellrowborder" valign="top" width="15.17%" headers="mcps1.2.5.1.1 "><p id="p3648159234"><a name="p3648159234"></a><a name="p3648159234"></a>description</p>
</td>
<td class="cellrowborder" valign="top" width="9.5%" headers="mcps1.2.5.1.2 "><p id="p8330194421616"><a name="p8330194421616"></a><a name="p8330194421616"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="12.55%" headers="mcps1.2.5.1.3 "><p id="p033012440165"><a name="p033012440165"></a><a name="p033012440165"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="62.78%" headers="mcps1.2.5.1.4 "><p id="p1060312315262"><a name="p1060312315262"></a><a name="p1060312315262"></a>状态描述。</p>
</td>
</tr>
</tbody>
</table>

**表 5**  RasrResponse数据结构

<a name="table41351312170"></a>
<table><thead align="left"><tr id="row213653121713"><th class="cellrowborder" valign="top" width="15.17%" id="mcps1.2.5.1.1"><p id="p381818315264"><a name="p381818315264"></a><a name="p381818315264"></a>参数名称</p>
</th>
<th class="cellrowborder" valign="top" width="9.68%" id="mcps1.2.5.1.2"><p id="p178185313261"><a name="p178185313261"></a><a name="p178185313261"></a>是否必选</p>
</th>
<th class="cellrowborder" valign="top" width="14.82%" id="mcps1.2.5.1.3"><p id="p18818143119267"><a name="p18818143119267"></a><a name="p18818143119267"></a>参数类型</p>
</th>
<th class="cellrowborder" valign="top" width="60.33%" id="mcps1.2.5.1.4"><p id="p19819831192612"><a name="p19819831192612"></a><a name="p19819831192612"></a>描述</p>
</th>
</tr>
</thead>
<tbody><tr id="row10136173131714"><td class="cellrowborder" valign="top" width="15.17%" headers="mcps1.2.5.1.1 "><p id="p2136431181717"><a name="p2136431181717"></a><a name="p2136431181717"></a>traceId</p>
</td>
<td class="cellrowborder" valign="top" width="9.68%" headers="mcps1.2.5.1.2 "><p id="p201369312170"><a name="p201369312170"></a><a name="p201369312170"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="14.82%" headers="mcps1.2.5.1.3 "><p id="p11361931181715"><a name="p11361931181715"></a><a name="p11361931181715"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="60.33%" headers="mcps1.2.5.1.4 "><p id="p1913643141712"><a name="p1913643141712"></a><a name="p1913643141712"></a>用于问题追溯。</p>
</td>
</tr>
<tr id="row13136531111714"><td class="cellrowborder" valign="top" width="15.17%" headers="mcps1.2.5.1.1 "><p id="p1136123131712"><a name="p1136123131712"></a><a name="p1136123131712"></a>sentenceList</p>
</td>
<td class="cellrowborder" valign="top" width="9.68%" headers="mcps1.2.5.1.2 "><p id="p39341642103019"><a name="p39341642103019"></a><a name="p39341642103019"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="14.82%" headers="mcps1.2.5.1.3 "><p id="p413613171715"><a name="p413613171715"></a><a name="p413613171715"></a>List&lt;RasrSentence&gt;</p>
</td>
<td class="cellrowborder" valign="top" width="60.33%" headers="mcps1.2.5.1.4 "><p id="p313633101718"><a name="p313633101718"></a><a name="p313633101718"></a>每一句识别结果，详见<a href="#table1398593524114">表 RasrSentence数据结构</a>。</p>
</td>
</tr>
</tbody>
</table>

**表 6**  RasrSentence数据结构

<a name="table1398593524114"></a>
<table><thead align="left"><tr id="row1498617350412"><th class="cellrowborder" valign="top" width="15.43%" id="mcps1.2.5.1.1"><p id="p2701185014410"><a name="p2701185014410"></a><a name="p2701185014410"></a>参数名称</p>
</th>
<th class="cellrowborder" valign="top" width="9.5%" id="mcps1.2.5.1.2"><p id="p1470135011412"><a name="p1470135011412"></a><a name="p1470135011412"></a>是否必选</p>
</th>
<th class="cellrowborder" valign="top" width="15.079999999999998%" id="mcps1.2.5.1.3"><p id="p77011350174110"><a name="p77011350174110"></a><a name="p77011350174110"></a>参数类型</p>
</th>
<th class="cellrowborder" valign="top" width="59.99%" id="mcps1.2.5.1.4"><p id="p187016506411"><a name="p187016506411"></a><a name="p187016506411"></a>描述</p>
</th>
</tr>
</thead>
<tbody><tr id="row4986163512414"><td class="cellrowborder" valign="top" width="15.43%" headers="mcps1.2.5.1.1 "><p id="p89866357414"><a name="p89866357414"></a><a name="p89866357414"></a>isFinal</p>
</td>
<td class="cellrowborder" valign="top" width="9.5%" headers="mcps1.2.5.1.2 "><p id="p15986635184110"><a name="p15986635184110"></a><a name="p15986635184110"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="15.079999999999998%" headers="mcps1.2.5.1.3 "><p id="p5986193514116"><a name="p5986193514116"></a><a name="p5986193514116"></a>Boolean</p>
</td>
<td class="cellrowborder" valign="top" width="59.99%" headers="mcps1.2.5.1.4 "><p id="p12986235144115"><a name="p12986235144115"></a><a name="p12986235144115"></a>是否为一句话最终结果，当设置返回中间结果时可以用到。</p>
</td>
</tr>
<tr id="row1098643520412"><td class="cellrowborder" valign="top" width="15.43%" headers="mcps1.2.5.1.1 "><p id="p1298623518412"><a name="p1298623518412"></a><a name="p1298623518412"></a>startTime</p>
</td>
<td class="cellrowborder" valign="top" width="9.5%" headers="mcps1.2.5.1.2 "><p id="p8986173512414"><a name="p8986173512414"></a><a name="p8986173512414"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="15.079999999999998%" headers="mcps1.2.5.1.3 "><p id="p8562123644719"><a name="p8562123644719"></a><a name="p8562123644719"></a>Integer</p>
</td>
<td class="cellrowborder" valign="top" width="59.99%" headers="mcps1.2.5.1.4 "><p id="p79866353411"><a name="p79866353411"></a><a name="p79866353411"></a>一句话开始时间。</p>
</td>
</tr>
<tr id="row1498623534117"><td class="cellrowborder" valign="top" width="15.43%" headers="mcps1.2.5.1.1 "><p id="p1398613544112"><a name="p1398613544112"></a><a name="p1398613544112"></a>endTime</p>
</td>
<td class="cellrowborder" valign="top" width="9.5%" headers="mcps1.2.5.1.2 "><p id="p89861635134117"><a name="p89861635134117"></a><a name="p89861635134117"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="15.079999999999998%" headers="mcps1.2.5.1.3 "><p id="p05831042104715"><a name="p05831042104715"></a><a name="p05831042104715"></a>Integer</p>
</td>
<td class="cellrowborder" valign="top" width="59.99%" headers="mcps1.2.5.1.4 "><p id="p19986123514118"><a name="p19986123514118"></a><a name="p19986123514118"></a>一句话结束时间。</p>
</td>
</tr>
<tr id="row598633584117"><td class="cellrowborder" valign="top" width="15.43%" headers="mcps1.2.5.1.1 "><p id="p9986173524116"><a name="p9986173524116"></a><a name="p9986173524116"></a>text</p>
</td>
<td class="cellrowborder" valign="top" width="9.5%" headers="mcps1.2.5.1.2 "><p id="p898603515414"><a name="p898603515414"></a><a name="p898603515414"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="15.079999999999998%" headers="mcps1.2.5.1.3 "><p id="p9986143574115"><a name="p9986143574115"></a><a name="p9986143574115"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="59.99%" headers="mcps1.2.5.1.4 "><p id="p189861135134119"><a name="p189861135134119"></a><a name="p189861135134119"></a>识别结果。</p>
</td>
</tr>
<tr id="row2986335184115"><td class="cellrowborder" valign="top" width="15.43%" headers="mcps1.2.5.1.1 "><p id="p898615358411"><a name="p898615358411"></a><a name="p898615358411"></a>score</p>
</td>
<td class="cellrowborder" valign="top" width="9.5%" headers="mcps1.2.5.1.2 "><p id="p199861835134115"><a name="p199861835134115"></a><a name="p199861835134115"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="15.079999999999998%" headers="mcps1.2.5.1.3 "><p id="p176190624815"><a name="p176190624815"></a><a name="p176190624815"></a>Float</p>
</td>
<td class="cellrowborder" valign="top" width="59.99%" headers="mcps1.2.5.1.4 "><p id="p8986143584114"><a name="p8986143584114"></a><a name="p8986143584114"></a>识别结果置信度。</p>
</td>
</tr>
</tbody>
</table>

## 示例代码<a name="section14227153614448"></a>

```
import com.huawei.sis.bean.SisConfig;
import com.huawei.sis.bean.SisConstant;
import com.huawei.sis.bean.request.RasrRequest;
import com.huawei.sis.bean.response.RasrResponse;
import com.huawei.sis.bean.base.RasrSentence;
import com.huawei.sis.bean.response.StateResponse;
import com.huawei.sis.bean.UserInfo;
import com.huawei.sis.client.RasrClient;
import com.huawei.sis.bean.RasrListener;

import java.util.List;

/**
 * 实时语音转写demo
 *
 * Copyright 2019 Huawei Technologies Co.,Ltd.
 */
public class RasrDemo {
  private static final int DEFAULT_HEAD_SILENCE_TIME = 1000;
  private static final int DEFAULT_TAIL_SILENCE_TIME = 500;
  private static final int DEFAULT_CONTINUE_SECONDS = 30;

  private String userName = "";       // 用户名
  private String password = "";       // 密码
  private String serviceRegion = "";  // 区域，如cn-north-1、cn-north-4
  private String projectId = "";      // 项目id，在我的凭证查看。参考https://support.huaweicloud.com/api-sis/sis_03_0008.html
  private String domainName = "";     // 账户名，一般等同于用户名

  private String path = "";           // 本地音频路径

  private String audioFormat = "";    // 音频格式，详见api文档或sdk文档
  private String property = "";       // 属性字符串，language_sampleRate_domain，如chinese_8k_common, 详见api文档

  /**
   * 实时语音转写参数设置，所有参数设置均为可选，均有默认值。用户根据需求设置参数。
   *
   * @param request request请求，包含各种参数
   */
  private void setParameters(RasrRequest request) {

    // 1. 设置是否添加标点符号，yes 或 no， 默认"no"
    request.setAddPunc("yes");
    // 2. 设置头部的最大静音时间，[0,60000], 默认10000ms
    request.setVadHead(DEFAULT_HEAD_SILENCE_TIME);
    // 3. 设置尾部最大静音时间，[0, 3000], 默认500ms，
    request.setVadTail(DEFAULT_TAIL_SILENCE_TIME);
    // 4. 设置最长持续时间，仅在continue-stream，sentence-stream模式下起作用，[1, 60], 默认30s
    request.setMaxSeconds(DEFAULT_CONTINUE_SECONDS);
    // 5. 设置是否显示中间结果，yes或no，默认“no”
    request.setIntermediateResult("no");
    // 6. 设置热词表id, 若没有则设置，否则会报错。
    // request.setVocabularyId(vocabularyId);
  }

  /**
   * 定义config，所有参数可选，设置超时时间。
   * @return SisConfig
   */
  private SisConfig getConfig() {
    SisConfig config = new SisConfig();
    // 设置连接超时，默认5000ms
    config.setConnectionTimeout(SisConstant.DEFAULT_CONNECTION_TIMEOUT);
    // 设置请求超时，默认1000ms
    config.setRequestTimeout(SisConstant.DEFAULT_CONNECTION_REQUEST_TIMEOUT);
    // 设置socket超时，默认5000ms
    config.setSocketTimeout(SisConstant.DEFAULT_SOCKET_TIMEOUT);
    // 设置代理, websocket目前仅支持不带用户密码的代理。使用前务必要确保代理是可用的，一般不建议使用。
    // config.setProxy(new ProxyHostInfo(host, port));
    return config;
  }

  /**
   * 打印响应结果。
   *
   * @param rasrResponse 识别结果类
   */
  private void printRasrResponse(RasrResponse rasrResponse) {
    // traceId， 用于分析日志，可忽略
    System.out.println("traceId = " + rasrResponse.getTraceId());

    // 打印语句
    List<RasrSentence> sentenceList = rasrResponse.getSentenceList();
    for (int i = 0; i < sentenceList.size(); i++) {
      RasrSentence sentence = sentenceList.get(i);
      // 语句索引
      System.out.println("{\n\tindex: " + (i + 1));
      // 每句话的中间结果还是最终结果
      System.out.println("\tis final: " + sentence.isFinal());
      // 语句起始时间，ms
      System.out.println("\tstart time: " + sentence.getStartTime());
      //　语句结束时间，ms
      System.out.println("\tend time: " + sentence.getEndTime());
      // 语句识别结果
      System.out.println("\ttext: " + sentence.getText());
      // 识别置信度，目前作用不大
      System.out.println("\tscore: " + sentence.getScore());
      System.out.println("}");
    }
    System.out.println();
  }

  private void printStateResponse(StateResponse response) {
    System.out.println("{\n\tstate: " + response.getState());
    System.out.println("\ttraceId: " + response.getTraceId());
    System.out.println("\tdescription: " + response.getDescription() + "\n}");
  }

  /**
   * 获取监听器，监听器的监听函数。
   *
   * @return RasrListener，用于监听实时语音转写的开始、识别结果、结束以及失败响应
   */
  private RasrListener getRasrListener() {
    RasrListener rasrListener = new RasrListener() {

      @Override
      /**
       * 响应结果
       */
      public void onTranscriptionResponse(RasrResponse rasrResponse) {
        printRasrResponse(rasrResponse);
      }

      @Override
      /**
       * 识别开始回调，返回traceId信息
       */
      public void onTranscriptionBegin(StateResponse response) {
        printStateResponse(response);
      }

      @Override
      /**
       * 识别结束回调，返回traceId等信息
       */
      public void onSTranscriptionEnd(StateResponse response) {
        printStateResponse(response);
      }

      @Override
      /**
       * 识别出错回调，这里指代已成功连接websocket，但是未成功识别结果。
       */
      public void onTranscriptionFail(StateResponse response) {
        printStateResponse(response);
      }
    };
    return rasrListener;
  }

  /**
   * 实时语音转写SDK的工作流程
   */
  private void process() {
    try {
      // 1. 实现监听器接口RasrListener，用户自定义收到响应的处理逻辑。
      RasrListener rasrListener = getRasrListener();

      // 2. 初始化RasrClient
      UserInfo userInfo = new UserInfo(userName, password, domainName, serviceRegion, projectId);
      RasrClient rasrClient = new RasrClient(userInfo, rasrListener, getConfig());

      // 3. 配置参数
      // audioFormat为支持格式、property为属性字符串，具体填写请详细参考api文档
      RasrRequest request = new RasrRequest(audioFormat, property);
      setParameters(request);

      // 4 选择连接模式，目前实时语音转写提供三种接口，流式一句话、实时语音转写连续模式、实时语音转写单句模式
      // 选择1 流式一句话连接
      // rasrClient.shortStreamConnect(request);

      // 选择2，实时语音转写单句模式
      // rasrClient.sentenceStreamConnect(request);

      // 选择3，实时语音转写连续模式
      rasrClient.continueStreamConnect(request);

      // 5. 发送开始请求、发送音频、发送end请求
      // 发送开始请求，即将开始请求连带配置发送至服务端
      rasrClient.sendStart();

      // 发送数据，在实时语音连续模式下可多次发送。识别结果可以通过监听器获取
      rasrClient.sendAudio(path);
      // 也可以自己控制发送速率.byteLen为每次发送大小，sleepTime为每次发送后睡眠时间(ms)。 也可直接发送byte流
      // rasrClient.sendAudio(path, byteLen, sleepTime);
      // rasrClient.sendByte(data, byteLen, sleepTime);

      // 发送结尾请求
      rasrClient.sendEnd();

      // 6. 关闭客户端。发送完毕后，此步一定要实施，否则服务端因为20s没有接受任何消息而报异常。
      rasrClient.close();

    } catch (Exception e) {
      e.printStackTrace();
    }

  }

  public static void main(String[] args) {
    RasrDemo rasrDemo = new RasrDemo();
    rasrDemo.process();
  }
}

```

